import{r as c,c as w,w as v,u as N,g as b,j as e,L as j,O as L}from"./chunk-JZWAC4HX-CFbAysJh.js";import{H as M}from"./Header-CorC32aj.js";const _=5e3;function $({userId:o,initialConversations:n}){const[d,i]=c.useState(n),s=w(),r=c.useRef(!1);return c.useEffect(()=>{i(n)},[n]),c.useEffect(()=>{var t;(t=s.data)!=null&&t.conversations&&s.state==="idle"&&i(s.data.conversations)},[s.data,s.state]),c.useEffect(()=>{if(!o||typeof window>"u")return;const a=setInterval(()=>{r.current||s.state==="idle"&&(r.current=!0,s.load("/api/conversations"),r.current=!1)},_);return()=>{clearInterval(a)}},[o,s]),{conversations:d,setConversations:i}}function k(o){const n=new Date(o),i=new Date().getTime()-n.getTime(),s=Math.floor(i/6e4),r=Math.floor(i/36e5),t=Math.floor(i/864e5);return s<1?"now":s<60?`${s}m`:r<24?`${r}h`:t<7?`${t}d`:n.toLocaleDateString()}const T=v(function(){const{user:n,conversations:d}=N(),s=b().id,{conversations:r}=$({userId:n.id,initialConversations:d});return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsx(M,{user:n}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"mx-auto max-w-7xl h-full flex px-4 sm:px-6 lg:px-8 py-16",children:[e.jsxs("aside",{className:`w-full md:w-80 lg:w-96 bg-white border border-gray-200 border-r-0 rounded-l-lg flex flex-col overflow-hidden ${s?"hidden md:flex":"flex"}`,children:[e.jsx("div",{className:"p-4 border-b border-gray-200 flex items-center h-[72px]",children:e.jsx("h1",{className:"font-display text-xl font-bold text-gray-900",children:"Messages"})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:r.length>0?e.jsx("div",{className:"divide-y divide-gray-100",children:r.map(t=>{var u,g,h,p;const a=t.participant_1===n.id?t.participant2:t.participant1,l=[...t.messages||[]].sort((x,y)=>new Date(y.created_at).getTime()-new Date(x.created_at).getTime())[0],f=(u=t.messages)==null?void 0:u.filter(x=>x.sender_id!==n.id&&!x.read_at).length,m=t.id===s;return e.jsxs(j,{to:`/messages/${t.id}`,className:`flex items-center gap-3 p-4 hover:bg-gray-50 transition-colors ${m?"bg-gray-100":""}`,children:[e.jsx("div",{className:`flex h-12 w-12 items-center justify-center rounded-full font-semibold flex-shrink-0 ${m?"bg-gray-600 text-white":"bg-brand-100 text-brand-700"}`,children:((g=a==null?void 0:a.company_name)==null?void 0:g.charAt(0))||((h=a==null?void 0:a.full_name)==null?void 0:h.charAt(0))||"?"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:`font-medium truncate text-sm ${f>0?"text-gray-900":"text-gray-600"}`,children:(a==null?void 0:a.company_name)||(a==null?void 0:a.full_name)||"User"}),l&&e.jsx("span",{className:"text-xs text-gray-400 flex-shrink-0",children:k(l.created_at)})]}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:((p=t.listing)==null?void 0:p.title)||"Listing"}),l&&e.jsxs("p",{className:`text-sm truncate mt-0.5 ${f>0?"text-gray-900 font-medium":"text-gray-500"}`,children:[l.sender_id===n.id&&e.jsx("span",{className:"text-gray-400",children:"You: "}),l.message_type==="heart"?"Listing saved":l.content]})]}),f>0&&!m&&e.jsx("div",{className:"h-3 w-3 rounded-full bg-red-500 flex-shrink-0"})]},t.id)})}):e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"No messages yet"}),e.jsx(j,{to:"/listings",className:"mt-4 btn-primary inline-block text-sm",children:"Browse Listings"})]})})]}),e.jsx("main",{className:`flex-1 flex flex-col ${s?"flex":"hidden md:flex"}`,children:e.jsx(L,{context:{user:n,conversations:r}})})]})})]})});export{T as default};
