import{r as n,j as t,w as z,u as F,f as H,c as O,F as A}from"./chunk-JZWAC4HX-Dlc7LzsC.js";import{H as W}from"./Header-DiP6E3C1.js";import{F as U}from"./FooterLight-j7wjw8pq.js";import{L as G}from"./ListingCard-DyuJ_FNu.js";import{L as Q}from"./ListingCardCompact-zqsE7_pc.js";const w=[{value:"newest",label:"Newest"},{value:"first_posted",label:"First posted"},{value:"event_soonest",label:"Event date (soonest)"},{value:"price_low",label:"Price: Low to High"},{value:"price_high",label:"Price: High to Low"},{value:"contact_price",label:"Contact for price"}];function V({value:x,onChange:l}){const[c,o]=n.useState(!1),d=n.useRef(null);return n.useEffect(()=>{function r(p){d.current&&!d.current.contains(p.target)&&o(!1)}return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]),w.find(r=>r.value===x)||w[0],t.jsxs("div",{ref:d,className:"relative",children:[t.jsxs("button",{type:"button",onClick:()=>o(!c),className:"flex items-center gap-1 px-2.5 py-1.5 sm:px-3 sm:py-2 bg-white text-gray-700 font-medium rounded-full border border-gray-300 hover:bg-gray-50 transition-colors",children:[t.jsx("svg",{className:"h-3.5 w-3.5 sm:h-4 sm:w-4 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"})}),t.jsx("svg",{className:`h-3.5 w-3.5 sm:h-4 sm:w-4 text-gray-400 transition-transform ${c?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),c&&t.jsx("div",{className:"absolute right-0 z-[100] mt-1 w-48 rounded-lg bg-white shadow-xl border border-gray-200 py-1 overflow-hidden",children:w.map(r=>t.jsx("button",{type:"button",onClick:()=>{l(r.value),o(!1)},className:`w-full px-4 py-2.5 text-left text-sm hover:bg-gray-50 transition-colors ${x===r.value?"bg-brand-50 text-brand-700 font-medium":"text-gray-700"}`,children:r.label},r.value))})]})}const ee=()=>[{title:"Browse Listings - Runoot"}],te=z(function(){const{user:l,listings:c,savedListingIds:o,events:d}=F(),[r]=H(),p=O(),f=n.useRef(null),i=r.get("type")||"all",a=r.get("search")||"",C=r.get("sort")||"newest",[u,y]=n.useState(a),[B,m]=n.useState(!1),[g,E]=n.useState(C),v=12;n.useEffect(()=>{L(v)},[i,a,g]);const j=[...c].sort((e,s)=>{var k,S;switch(g){case"newest":return new Date(s.created_at).getTime()-new Date(e.created_at).getTime();case"first_posted":return new Date(e.created_at).getTime()-new Date(s.created_at).getTime();case"event_soonest":const I=(k=e.event)!=null&&k.event_date?new Date(e.event.event_date).getTime():1/0,M=(S=s.event)!=null&&S.event_date?new Date(s.event.event_date).getTime():1/0;return I-M;case"price_low":const P=e.price!=null?e.price:1/0,R=s.price!=null?s.price:1/0;return P-R;case"price_high":const $=e.price!=null?e.price:-1/0;return(s.price!=null?s.price:-1/0)-$;case"contact_price":return new Date(s.created_at).getTime()-new Date(e.created_at).getTime();default:return 0}}),h=g==="contact_price"?j.filter(e=>e.price==null):j,[b,L]=n.useState(v),N=h.slice(0,b),T=b<h.length,_=u.length>=2?d.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())||e.country.toLowerCase().includes(u.toLowerCase())).slice(0,5):[];n.useEffect(()=>{function e(s){f.current&&!f.current.contains(s.target)&&m(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const D=e=>{y(e),m(!1);const s=new URLSearchParams;i!=="all"&&s.set("type",i),s.set("search",e),p(`/listings?${s.toString()}`)};return t.jsx("div",{className:"min-h-screen bg-[url('/savedBG.png')] bg-cover bg-center bg-fixed",children:t.jsxs("div",{className:"min-h-screen bg-gray-50/60 md:bg-gray-50/85 flex flex-col",children:[t.jsx(W,{user:l}),t.jsxs("main",{className:"mx-auto max-w-7xl px-4 py-8 pb-24 md:pb-8 sm:px-6 lg:px-8 flex-grow w-full",children:[t.jsxs("div",{className:"relative z-10 mb-8 bg-white/70 backdrop-blur-sm rounded-xl shadow-md px-3 py-4 sm:p-6",children:[t.jsx("h1",{className:"font-display text-2xl sm:text-3xl font-bold text-gray-900 text-center sm:text-left",children:"Browse Listings"}),t.jsx("p",{className:"hidden sm:block mt-2 text-gray-600 mb-8",children:"Find available rooms and bibs for upcoming marathons"}),t.jsx("div",{className:"sm:hidden mb-6"}),t.jsxs(A,{method:"get",name:"listing-search",className:"mb-6",children:[t.jsx("input",{type:"hidden",name:"type",value:i}),t.jsxs("div",{className:"relative max-w-xl",ref:f,children:[t.jsx("svg",{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 z-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),t.jsx("input",{type:"search",id:"listing-search",name:"search",autoComplete:"off",placeholder:"Search event name...",value:u,onChange:e=>{y(e.target.value),m(!0)},onFocus:()=>m(!0),className:"block w-full rounded-full border-0 pl-12 pr-20 py-3 text-gray-900 placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-brand-500/20 transition-colors shadow-md ring-1 ring-gray-200"}),t.jsx("button",{type:"submit",className:"absolute right-1.5 top-1/2 -translate-y-1/2 px-5 py-2 bg-accent-500 text-white text-sm font-medium rounded-full hover:bg-accent-600 transition-all",children:"Search"}),B&&_.length>0&&t.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-lg border border-gray-200 z-20 overflow-hidden",children:_.map(e=>t.jsxs("button",{type:"button",onClick:()=>D(e.name),className:"w-full px-4 py-3 text-left hover:bg-gray-50 border-b border-gray-100 last:border-b-0 transition-colors",children:[t.jsx("p",{className:"font-medium text-gray-900",children:e.name}),t.jsxs("p",{className:"text-sm text-gray-500",children:[e.country," â€¢ ",new Date(e.event_date).toLocaleDateString()]})]},e.id))})]})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[[{value:"all",label:"All"},{value:"room",label:"Hotel"},{value:"bib",label:"Bibs"},{value:"room_and_bib",label:"Package"}].map(e=>t.jsx("a",{href:e.value==="all"?`/listings${a?`?search=${a}`:""}`:`/listings?type=${e.value}${a?`&search=${a}`:""}`,className:`px-2.5 py-1.5 sm:px-4 sm:py-2 rounded-full text-xs sm:text-sm font-medium transition-colors ${i===e.value?"bg-brand-500 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:e.label},e.value)),t.jsx(V,{value:g,onChange:E})]})]}),h.length>0?t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"hidden md:grid gap-6 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 auto-rows-fr relative z-0",children:N.map(e=>t.jsx(G,{listing:e,isUserLoggedIn:!!l,isSaved:(o||[]).includes(e.id)},e.id))}),t.jsx("div",{className:"flex flex-col gap-3 md:hidden relative z-0",children:N.map(e=>t.jsx(Q,{listing:e,isUserLoggedIn:!!l,isSaved:(o||[]).includes(e.id)},e.id))}),T&&t.jsx("div",{className:"mt-8 text-center",children:t.jsxs("button",{onClick:()=>L(e=>e+v),className:"px-8 py-3 bg-white text-gray-700 font-medium rounded-full border border-gray-300 hover:bg-gray-50 transition-colors shadow-md",children:["Load More (",h.length-b," remaining)"]})})]}):t.jsxs("div",{className:"text-center py-12",children:[t.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),t.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900",children:"No listings found"}),t.jsx("p",{className:"mt-2 text-gray-600",children:a||i!=="all"?"Try adjusting your filters":"Be the first to create a listing!"})]})]}),t.jsx(U,{})]})})});export{te as default,ee as meta};
